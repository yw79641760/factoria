# Factoria ç³»ç»Ÿæ¶æ„è®¾è®¡ v2.0

## æ–‡æ¡£ä¿¡æ¯
- **ç‰ˆæœ¬**: 2.0ï¼ˆèƒ½åŠ›é©±åŠ¨æ¶æ„ï¼‰
- **åˆ›å»ºæ—¥æœŸ**: 2026-02-26
- **ç»´æŠ¤è€…**: Factoria Team
- **çŠ¶æ€**: ğŸ¯ è®¾è®¡ä¸­

## æ ¸å¿ƒå…¬å¼

**Agent-Native Software = Framework(Abilities Orchestrated by LLM)**

```
Factoria 
= Framework (Abilities Orchestrated by GLM-5)
= æ¡†æ¶ (GLM-5ç¼–æ’çš„èƒ½åŠ›)
```

---

## 1. æ¶æ„æ¦‚è¿°

### 1.1 ä¸‰å±‚æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Layer 1: Framework                        â”‚
â”‚                      å‘ˆç°å±‚ï¼ˆShellï¼‰                          â”‚
â”‚  â”œâ”€ Web (React + Vite + Tailwind)                           â”‚
â”‚  â”œâ”€ PWA (Progressive Web App)                               â”‚
â”‚  â””â”€ Mobile (æœªæ¥ï¼šiOS / Android)                            â”‚
â”‚  èŒè´£ï¼šéœ€æ±‚å®ç°çš„æœ€ç»ˆå‘ˆç°                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚ è°ƒç”¨
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Layer 2: Orchestrated by LLM                    â”‚
â”‚                   ä¸šåŠ¡é€»è¾‘å±‚ï¼ˆç¼–æ’ï¼‰                           â”‚
â”‚  â”œâ”€ æ•°æ®æŒ–æ˜çš„ä¸šåŠ¡é€»è¾‘                                        â”‚
â”‚  â”œâ”€ PRDå®šä¹‰çš„ä¸šåŠ¡é€»è¾‘                                         â”‚
â”‚  â””â”€ äººå·¥æè¿°çš„ä¸šåŠ¡é€»è¾‘                                        â”‚
â”‚  èŒè´£ï¼šå°†å°éœ€æ±‚å®ç°è¿›è¡Œæœ‰æœºæ•´åˆ                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚ ç¼–æ’
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Layer 3: Abilities                        â”‚
â”‚                   èƒ½åŠ›å±‚ï¼ˆAgent Skillsï¼‰                       â”‚
â”‚  â”œâ”€ ç¡®å®šæ€§èƒ½åŠ›ï¼ˆç¬¦å·ä¸»ä¹‰ï¼‰                                    â”‚
â”‚  â”‚   â””â”€ math, string, array, date, format                   â”‚
â”‚  â”œâ”€ éç¡®å®šæ€§èƒ½åŠ›ï¼ˆè¿æ¥ä¸»ä¹‰ï¼‰                                  â”‚
â”‚  â”‚   â””â”€ vision, nlp, recommendation                         â”‚
â”‚  â””â”€ APIèƒ½åŠ›                                                 â”‚
â”‚      â””â”€ http, storage, geolocation                          â”‚
â”‚  èŒè´£ï¼šå°†éœ€æ±‚æ‹†è§£æˆå°éœ€æ±‚ï¼Œèƒ½åŠ›å¤ç”¨ï¼Œç³»ç»Ÿå¤æ‚æ€§æ§åˆ¶              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 æ¶æ„ç‰¹ç‚¹

**ä»æ¨¡æ¿é©±åŠ¨ â†’ èƒ½åŠ›é©±åŠ¨**

| ç»´åº¦ | v1.0ï¼ˆæ¨¡æ¿é©±åŠ¨ï¼‰ | v2.0ï¼ˆèƒ½åŠ›é©±åŠ¨ï¼‰ |
|------|----------------|-----------------|
| **æ ¸å¿ƒæ€è·¯** | é¢„å®šä¹‰æ¨¡æ¿ | èƒ½åŠ›ç»„åˆ |
| **æ‰©å±•æ–¹å¼** | éœ€è¦æ–°æ¨¡æ¿ | æ²‰æ·€æ–°èƒ½åŠ› |
| **LLMè§’è‰²** | å¡«å……å˜é‡ | ç¼–æ’èƒ½åŠ› |
| **é€‚ç”¨åœºæ™¯** | å›ºå®šåœºæ™¯ | ä¸ç¡®å®šæ€§åœºæ™¯ |
| **å“²å­¦** | ç¬¦å·ä¸»ä¹‰ | ç¬¦å·ä¸»ä¹‰ + è¿æ¥ä¸»ä¹‰ |

---

## 2. Layer 1: Frameworkï¼ˆå‘ˆç°å±‚ï¼‰

### 2.1 èŒè´£

- æä¾›ç»Ÿä¸€çš„ç”¨æˆ·ç•Œé¢
- ç®¡ç†åº”ç”¨ç”Ÿå‘½å‘¨æœŸ
- å¤„ç†ç”¨æˆ·è¾“å…¥è¾“å‡º
- ä¸å…³å¿ƒä¸šåŠ¡é€»è¾‘ï¼Œåªè´Ÿè´£å‘ˆç°

### 2.2 æŠ€æœ¯æ ˆ

```
Framework Stack
â”œâ”€ æ ¸å¿ƒï¼šReact 18 + TypeScript
â”œâ”€ æ„å»ºï¼šVite 7
â”œâ”€ æ ·å¼ï¼šTailwind CSS 4
â”œâ”€ éƒ¨ç½²ï¼šVercel (Web/PWA)
â””â”€ æœªæ¥ï¼šReact Native (Mobile)
```

### 2.3 æ¡†æ¶è®¾è®¡

```typescript
// @factoria/core - Frameworkå±‚

import React from 'react';

/**
 * APPæ¡†æ¶å®šä¹‰
 */
export class Framework {
  /**
   * å®šä¹‰ä¸€ä¸ªåº”ç”¨
   */
  static define<TInputs, TOutput>(config: {
    // åº”ç”¨å…ƒä¿¡æ¯
    name: string;
    description?: string;
    version?: string;
    
    // è¾“å…¥å®šä¹‰
    inputs: InputField[];
    
    // è®¡ç®—é€»è¾‘ï¼ˆç”±LLMç”Ÿæˆï¼‰
    compute: (inputs: TInputs, abilities: Abilities) => Promise<TOutput> | TOutput;
    
    // å±•ç¤ºé€»è¾‘ï¼ˆç”±LLMç”Ÿæˆï¼‰
    display: (output: TOutput) => React.ReactNode;
    
    // ä¸»é¢˜é…ç½®ï¼ˆå¯é€‰ï¼‰
    theme?: ThemeConfig;
  }) {
    // è¿”å›ä¸€ä¸ªReactç»„ä»¶
    return function GeneratedApp() {
      const [inputs, setInputs] = useState<Partial<TInputs>>({});
      const [output, setOutput] = useState<TOutput | null>(null);
      const [loading, setLoading] = useState(false);
      const [error, setError] = useState<Error | null>(null);
      
      // è·å–èƒ½åŠ›
      const abilities = useAbilities();
      
      // å¤„ç†æäº¤
      const handleSubmit = async () => {
        setLoading(true);
        setError(null);
        
        try {
          const result = await config.compute(inputs as TInputs, abilities);
          setOutput(result);
        } catch (err) {
          setError(err as Error);
        } finally {
          setLoading(false);
        }
      };
      
      // æ¸²æŸ“
      return (
        <div className="app-framework">
          <Header name={config.name} description={config.description} />
          
          <InputForm 
            fields={config.inputs}
            values={inputs}
            onChange={setInputs}
          />
          
          <SubmitButton onClick={handleSubmit} loading={loading} />
          
          {error && <ErrorDisplay error={error} />}
          
          {output && (
            <OutputDisplay>
              {config.display(output)}
            </OutputDisplay>
          )}
        </div>
      );
    };
  }
}

/**
 * è¾“å…¥å­—æ®µå®šä¹‰
 */
interface InputField {
  name: string;
  type: 'text' | 'number' | 'date' | 'select' | 'textarea' | 'file';
  label?: string;
  placeholder?: string;
  required?: boolean;
  defaultValue?: any;
  options?: string[];  // for select
  validation?: ValidationRule;
}

/**
 * ä¸»é¢˜é…ç½®
 */
interface ThemeConfig {
  primaryColor?: string;
  gradient?: string;
  dark?: boolean;
}
```

### 2.4 æ¡†æ¶ç¤ºä¾‹

**Webæ¡†æ¶**ï¼ˆå½“å‰ï¼‰ï¼š
```typescript
// PWAæ¡†æ¶
import { Framework } from '@factoria/core';

const BMIApp = Framework.define({
  name: 'BMIè®¡ç®—å™¨',
  inputs: [
    { name: 'èº«é«˜', type: 'number', label: 'èº«é«˜(cm)', required: true },
    { name: 'ä½“é‡', type: 'number', label: 'ä½“é‡(kg)', required: true }
  ],
  
  compute: (inputs, abilities) => {
    const { math, format } = abilities;
    const bmi = math.divide(inputs.ä½“é‡, math.pow(inputs.èº«é«˜ / 100, 2));
    return { bmi: format.number(bmi, 2) };
  },
  
  display: (output) => (
    <div className="text-center">
      <div className="text-5xl font-bold">{output.bmi}</div>
    </div>
  )
});
```

**Mobileæ¡†æ¶**ï¼ˆæœªæ¥ï¼‰ï¼š
```typescript
// React Nativeæ¡†æ¶
import { Framework } from '@factoria/mobile';

const BMIApp = Framework.define({
  // ç›¸åŒçš„é…ç½®ï¼Œä¸åŒçš„å‘ˆç°
  name: 'BMIè®¡ç®—å™¨',
  inputs: [...],
  compute: (inputs, abilities) => { /* ç›¸åŒé€»è¾‘ */ },
  display: (output) => (
    <View style={styles.container}>
      <Text style={styles.result}>{output.bmi}</Text>
    </View>
  )
});
```

---

## 3. Layer 2: Orchestrated by LLMï¼ˆä¸šåŠ¡é€»è¾‘å±‚ï¼‰

### 3.1 èŒè´£

- ç†è§£ç”¨æˆ·éœ€æ±‚
- è¯†åˆ«éœ€è¦çš„èƒ½åŠ›
- ç”Ÿæˆç¼–æ’é€»è¾‘
- æœ‰æœºæ•´åˆä¸ºå®Œæ•´åº”ç”¨

### 3.2 ä¸šåŠ¡é€»è¾‘æ¥æº

```
Orchestration Sources
â”œâ”€ äººå·¥æè¿°ï¼ˆå½“å‰ï¼‰
â”‚   â””â”€ ç”¨æˆ·çš„è‡ªç„¶è¯­è¨€éœ€æ±‚
â”‚       ä¾‹å¦‚ï¼š"åšä¸€ä¸ªBMIè®¡ç®—å™¨"
â”‚
â”œâ”€ PRDå®šä¹‰ï¼ˆæœªæ¥ï¼‰
â”‚   â””â”€ äº§å“éœ€æ±‚æ–‡æ¡£è§£æ
â”‚       ä¾‹å¦‚ï¼šä»Notion/é£ä¹¦æ–‡æ¡£æå–éœ€æ±‚
â”‚
â””â”€ æ•°æ®æŒ–æ˜ï¼ˆæœªæ¥ï¼‰
    â””â”€ ä»å†å²æ•°æ®å‘ç°æ¨¡å¼
        ä¾‹å¦‚ï¼šåˆ†æç”¨æˆ·è¡Œä¸ºï¼Œæ¨èå¸¸ç”¨èƒ½åŠ›ç»„åˆ
```

### 3.3 LLMç¼–æ’æµç¨‹

```
ç”¨æˆ·éœ€æ±‚ï¼ˆ"åšä¸€ä¸ªBMIè®¡ç®—å™¨"ï¼‰
    â†“
ã€Step 1: éœ€æ±‚ç†è§£ã€‘
    â”œâ”€ æå–å…³é”®ä¿¡æ¯ï¼šBMIã€è®¡ç®—å™¨
    â”œâ”€ è¯†åˆ«é¢†åŸŸï¼šå¥åº·/åŒ»ç–—
    â””â”€ ç†è§£ç›®æ ‡ï¼šè®¡ç®—èº«ä½“è´¨é‡æŒ‡æ•°
    â†“
ã€Step 2: èƒ½åŠ›è¯†åˆ«ã€‘
    éœ€è¦å“ªäº›èƒ½åŠ›ï¼Ÿ
    â”œâ”€ è¾“å…¥èƒ½åŠ›ï¼šUIè¡¨å•
    â”œâ”€ æ•°å­¦èƒ½åŠ›ï¼šé™¤æ³•ã€ä¹˜æ–¹
    â”œâ”€ æ ¼å¼åŒ–èƒ½åŠ›ï¼šæ•°å­—æ ¼å¼åŒ–
    â””â”€ å±•ç¤ºèƒ½åŠ›ï¼šç»“æœæ¸²æŸ“
    â†“
ã€Step 3: ç¼–æ’ç”Ÿæˆã€‘
    ç”Ÿæˆä»£ç ï¼š
    ```typescript
    Framework.define({
      name: 'BMIè®¡ç®—å™¨',
      inputs: [
        { name: 'èº«é«˜', type: 'number', unit: 'cm' },
        { name: 'ä½“é‡', type: 'number', unit: 'kg' }
      ],
      compute: (inputs, { math, format }) => {
        const height = math.divide(inputs.èº«é«˜, 100);
        const bmi = math.divide(inputs.ä½“é‡, math.pow(height, 2));
        return { bmi: format.number(bmi, 2) };
      },
      display: (result) => <div>{result.bmi}</div>
    })
    ```
    â†“
ã€Step 4: æœ‰æœºæ•´åˆã€‘
    åœ¨æ¡†æ¶ä¸­è¿è¡Œï¼Œå½¢æˆå®Œæ•´åº”ç”¨
```

### 3.4 GLM-5 Promptè®¾è®¡

```typescript
// api/lib/orchestrator.ts

export class Orchestrator {
  /**
   * ç”Ÿæˆç¼–æ’ä»£ç 
   */
  async orchestrate(userNeed: string): Promise<OrchestrationResult> {
    const systemPrompt = `
ä½ æ˜¯ä¸€ä¸ªåº”ç”¨ç¼–æ’ä¸“å®¶ã€‚æ ¹æ®ç”¨æˆ·éœ€æ±‚ï¼Œç”Ÿæˆèƒ½åŠ›ç¼–æ’ä»£ç ã€‚

å¯ç”¨èƒ½åŠ›ï¼š
- math: æ•°å­¦èƒ½åŠ›ï¼ˆadd, subtract, multiply, divide, pow, sqrtï¼‰
- format: æ ¼å¼åŒ–èƒ½åŠ›ï¼ˆnumber, currency, dateï¼‰
- http: HTTPèƒ½åŠ›ï¼ˆget, postï¼‰
- storage: å­˜å‚¨èƒ½åŠ›ï¼ˆget, set, removeï¼‰
- device: è®¾å¤‡èƒ½åŠ›ï¼ˆgeolocation, cameraï¼‰

æ¡†æ¶APIï¼š
Framework.define({
  name: string,
  inputs: InputField[],
  compute: (inputs, abilities) => output,
  display: (output) => ReactNode
})

è¦æ±‚ï¼š
1. è¯†åˆ«éœ€è¦çš„èƒ½åŠ›
2. ç”Ÿæˆå®Œæ•´çš„ç¼–æ’ä»£ç 
3. ä»£ç åº”è¯¥ç®€æ´ã€é«˜æ•ˆ
4. ä½¿ç”¨TypeScriptè¯­æ³•
    `;

    const response = await this.glm5.chat([
      { role: 'system', content: systemPrompt },
      { role: 'user', content: `ç”¨æˆ·éœ€æ±‚ï¼š${userNeed}` }
    ]);

    // è§£æç”Ÿæˆçš„ä»£ç 
    const code = this.extractCode(response);
    
    return {
      code,
      abilities: this.extractAbilities(code),
      inputs: this.extractInputs(code)
    };
  }
}
```

---

## 4. Layer 3: Abilitiesï¼ˆèƒ½åŠ›å±‚ï¼‰

### 4.1 èŒè´£

- æä¾›åŸå­åŒ–çš„ã€å¯å¤ç”¨çš„èƒ½åŠ›
- å°†éœ€æ±‚æ‹†è§£æˆå°éœ€æ±‚
- æ§åˆ¶ç³»ç»Ÿå¤æ‚æ€§

### 4.2 èƒ½åŠ›åˆ†ç±»

```typescript
// @factoria/abilities - èƒ½åŠ›åº“

/**
 * èƒ½åŠ›ç±»å‹
 */
type AbilityType = 
  | 'pure'        // çº¯å‡½æ•°ï¼Œç¡®å®šæ€§
  | 'ai'          // AIèƒ½åŠ›ï¼Œæœ‰é™éç¡®å®šæ€§
  | 'api'         // APIèƒ½åŠ›ï¼Œéœ€è¦ç½‘ç»œ
  | 'device';     // è®¾å¤‡èƒ½åŠ›ï¼Œéœ€è¦ç¡¬ä»¶

/**
 * èƒ½åŠ›å®šä¹‰
 */
interface Ability {
  name: string;
  type: AbilityType;
  description: string;
  functions: Record<string, Function>;
  metadata?: {
    accuracy?: number;  // AIèƒ½åŠ›çš„å‡†ç¡®ç‡
    latency?: number;   // å¹³å‡å»¶è¿Ÿ
  };
}
```

### 4.3 ç¡®å®šæ€§èƒ½åŠ›ï¼ˆç¬¦å·ä¸»ä¹‰ï¼‰

```typescript
/**
 * æ•°å­¦èƒ½åŠ›ï¼ˆç¡®å®šæ€§ï¼‰
 */
export const mathAbility: Ability = {
  name: 'math',
  type: 'pure',
  description: 'æ•°å­¦è®¡ç®—èƒ½åŠ›',
  functions: {
    add: (a: number, b: number) => a + b,
    subtract: (a: number, b: number) => a - b,
    multiply: (a: number, b: number) => a * b,
    divide: (a: number, b: number) => {
      if (b === 0) throw new Error('Division by zero');
      return a / b;
    },
    pow: (base: number, exponent: number) => Math.pow(base, exponent),
    sqrt: (num: number) => Math.sqrt(num),
    abs: (num: number) => Math.abs(num),
    round: (num: number, decimals: number = 0) => {
      const factor = Math.pow(10, decimals);
      return Math.round(num * factor) / factor;
    }
  }
};

/**
 * å­—ç¬¦ä¸²èƒ½åŠ›ï¼ˆç¡®å®šæ€§ï¼‰
 */
export const stringAbility: Ability = {
  name: 'string',
  type: 'pure',
  description: 'å­—ç¬¦ä¸²å¤„ç†èƒ½åŠ›',
  functions: {
    split: (str: string, separator: string) => str.split(separator),
    join: (arr: string[], separator: string) => arr.join(separator),
    trim: (str: string) => str.trim(),
    toUpperCase: (str: string) => str.toUpperCase(),
    toLowerCase: (str: string) => str.toLowerCase(),
    replace: (str: string, search: string, replace: string) => 
      str.replace(new RegExp(search, 'g'), replace),
    format: (template: string, ...args: any[]) => 
      template.replace(/{}/g, () => args.shift())
  }
};

/**
 * æ ¼å¼åŒ–èƒ½åŠ›ï¼ˆç¡®å®šæ€§ï¼‰
 */
export const formatAbility: Ability = {
  name: 'format',
  type: 'pure',
  description: 'æ•°æ®æ ¼å¼åŒ–èƒ½åŠ›',
  functions: {
    number: (num: number, decimals: number = 2) => num.toFixed(decimals),
    currency: (amount: number, currency: string = 'CNY') => 
      new Intl.NumberFormat('zh-CN', { 
        style: 'currency', 
        currency 
      }).format(amount),
    date: (date: Date | string, format: string = 'YYYY-MM-DD') => {
      const d = new Date(date);
      const year = d.getFullYear();
      const month = String(d.getMonth() + 1).padStart(2, '0');
      const day = String(d.getDate()).padStart(2, '0');
      return format
        .replace('YYYY', String(year))
        .replace('MM', month)
        .replace('DD', day);
    },
    percentage: (num: number, decimals: number = 2) => 
      `${(num * 100).toFixed(decimals)}%`
  }
};

/**
 * æ•°ç»„èƒ½åŠ›ï¼ˆç¡®å®šæ€§ï¼‰
 */
export const arrayAbility: Ability = {
  name: 'array',
  type: 'pure',
  description: 'æ•°ç»„å¤„ç†èƒ½åŠ›',
  functions: {
    map: <T, U>(arr: T[], fn: (item: T) => U) => arr.map(fn),
    filter: <T>(arr: T[], fn: (item: T) => boolean) => arr.filter(fn),
    reduce: <T, U>(arr: T[], fn: (acc: U, item: T) => U, initial: U) => 
      arr.reduce(fn, initial),
    sort: <T>(arr: T[], fn?: (a: T, b: T) => number) => 
      [...arr].sort(fn),
    unique: <T>(arr: T[]) => [...new Set(arr)],
    flatten: <T>(arr: T[][]) => arr.flat()
  }
};
```

### 4.4 éç¡®å®šæ€§èƒ½åŠ›ï¼ˆè¿æ¥ä¸»ä¹‰ï¼‰

```typescript
/**
 * è§†è§‰èƒ½åŠ›ï¼ˆæœ‰é™éç¡®å®šæ€§ï¼‰
 */
export const visionAbility: Ability = {
  name: 'vision',
  type: 'ai',
  description: 'å›¾åƒè¯†åˆ«èƒ½åŠ›',
  metadata: {
    accuracy: 0.95,  // 95%å‡†ç¡®ç‡
    latency: 500     // å¹³å‡500ms
  },
  functions: {
    classify: async (image: Blob): Promise<string> => {
      // è°ƒç”¨å›¾åƒåˆ†ç±»API
      const result = await callVisionAPI('classify', image);
      return result.label;
    },
    
    detect: async (image: Blob): Promise<Detection[]> => {
      // è°ƒç”¨ç›®æ ‡æ£€æµ‹API
      const result = await callVisionAPI('detect', image);
      return result.objects;
    },
    
    ocr: async (image: Blob): Promise<string> => {
      // è°ƒç”¨OCR API
      const result = await callVisionAPI('ocr', image);
      return result.text;
    }
  }
};

/**
 * NLPèƒ½åŠ›ï¼ˆæœ‰é™éç¡®å®šæ€§ï¼‰
 */
export const nlpAbility: Ability = {
  name: 'nlp',
  type: 'ai',
  description: 'è‡ªç„¶è¯­è¨€å¤„ç†èƒ½åŠ›',
  metadata: {
    accuracy: 0.92,
    latency: 300
  },
  functions: {
    sentiment: async (text: string): Promise<SentimentResult> => {
      // æƒ…æ„Ÿåˆ†æ
      const result = await callNLPAPI('sentiment', text);
      return {
        score: result.score,
        label: result.label
      };
    },
    
    extract: async (text: string, type: string): Promise<string[]> => {
      // å®ä½“æŠ½å–
      const result = await callNLPAPI('extract', { text, type });
      return result.entities;
    },
    
    summarize: async (text: string, maxLength: number): Promise<string> => {
      // æ–‡æœ¬æ‘˜è¦
      const result = await callNLPAPI('summarize', { text, maxLength });
      return result.summary;
    }
  }
};
```

### 4.5 APIèƒ½åŠ›

```typescript
/**
 * HTTPèƒ½åŠ›
 */
export const httpAbility: Ability = {
  name: 'http',
  type: 'api',
  description: 'HTTPè¯·æ±‚èƒ½åŠ›',
  functions: {
    get: async (url: string, options?: RequestOptions) => {
      const response = await fetch(url, {
        method: 'GET',
        headers: options?.headers
      });
      
      if (!response.ok) {
        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
      }
      
      return response.json();
    },
    
    post: async (url: string, data: any, options?: RequestOptions) => {
      const response = await fetch(url, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          ...options?.headers
        },
        body: JSON.stringify(data)
      });
      
      if (!response.ok) {
        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
      }
      
      return response.json();
    }
  }
};

/**
 * å­˜å‚¨èƒ½åŠ›
 */
export const storageAbility: Ability = {
  name: 'storage',
  type: 'api',
  description: 'æœ¬åœ°å­˜å‚¨èƒ½åŠ›',
  functions: {
    get: (key: string) => {
      const value = localStorage.getItem(key);
      return value ? JSON.parse(value) : null;
    },
    
    set: (key: string, value: any) => {
      localStorage.setItem(key, JSON.stringify(value));
    },
    
    remove: (key: string) => {
      localStorage.removeItem(key);
    },
    
    clear: () => {
      localStorage.clear();
    }
  }
};

/**
 * åœ°ç†ä½ç½®èƒ½åŠ›
 */
export const geolocationAbility: Ability = {
  name: 'geolocation',
  type: 'device',
  description: 'åœ°ç†ä½ç½®èƒ½åŠ›',
  functions: {
    getCurrentPosition: (): Promise<GeolocationPosition> => {
      return new Promise((resolve, reject) => {
        navigator.geolocation.getCurrentPosition(resolve, reject);
      });
    },
    
    watchPosition: (callback: (position: GeolocationPosition) => void) => {
      return navigator.geolocation.watchPosition(callback);
    },
    
    clearWatch: (watchId: number) => {
      navigator.geolocation.clearWatch(watchId);
    }
  }
};
```

### 4.6 èƒ½åŠ›æ³¨å†Œä¸ä½¿ç”¨

```typescript
// @factoria/abilities

/**
 * èƒ½åŠ›æ³¨å†Œè¡¨
 */
class AbilityRegistry {
  private abilities = new Map<string, Ability>();
  
  /**
   * æ³¨å†Œèƒ½åŠ›
   */
  register(ability: Ability) {
    this.abilities.set(ability.name, ability);
  }
  
  /**
   * è·å–èƒ½åŠ›
   */
  get(name: string): Ability | undefined {
    return this.abilities.get(name);
  }
  
  /**
   * è·å–æ‰€æœ‰èƒ½åŠ›
   */
  getAll(): Ability[] {
    return Array.from(this.abilities.values());
  }
  
  /**
   * æŒ‰ç±»å‹è·å–èƒ½åŠ›
   */
  getByType(type: AbilityType): Ability[] {
    return this.getAll().filter(a => a.type === type);
  }
}

// å…¨å±€æ³¨å†Œè¡¨
const registry = new AbilityRegistry();

// æ³¨å†ŒåŸºç¡€èƒ½åŠ›
registry.register(mathAbility);
registry.register(stringAbility);
registry.register(formatAbility);
registry.register(arrayAbility);
registry.register(httpAbility);
registry.register(storageAbility);
registry.register(geolocationAbility);

// æœªæ¥æ³¨å†ŒAIèƒ½åŠ›
// registry.register(visionAbility);
// registry.register(nlpAbility);

/**
 * ä½¿ç”¨èƒ½åŠ›çš„Hook
 */
export function useAbilities(): Record<string, any> {
  const abilities: Record<string, any> = {};
  
  registry.getAll().forEach(ability => {
    abilities[ability.name] = ability.functions;
  });
  
  return abilities;
}

/**
 * è·å–ç‰¹å®šèƒ½åŠ›
 */
export function useAbility<T = any>(name: string): T {
  const ability = registry.get(name);
  if (!ability) {
    throw new Error(`Ability not found: ${name}`);
  }
  return ability.functions as T;
}
```

---

## 5. å®Œæ•´ç¤ºä¾‹

### 5.1 BMIè®¡ç®—å™¨

**ç”¨æˆ·éœ€æ±‚**ï¼š"åšä¸€ä¸ªBMIè®¡ç®—å™¨"

**LLMç¼–æ’**ï¼š
```typescript
import { Framework } from '@factoria/core';
import { math, format } from '@factoria/abilities';

export default Framework.define({
  name: 'BMIè®¡ç®—å™¨',
  description: 'è®¡ç®—èº«ä½“è´¨é‡æŒ‡æ•°',
  
  inputs: [
    {
      name: 'èº«é«˜',
      type: 'number',
      label: 'èº«é«˜(cm)',
      placeholder: 'è¯·è¾“å…¥èº«é«˜',
      required: true,
      validation: { min: 50, max: 250 }
    },
    {
      name: 'ä½“é‡',
      type: 'number',
      label: 'ä½“é‡(kg)',
      placeholder: 'è¯·è¾“å…¥ä½“é‡',
      required: true,
      validation: { min: 20, max: 300 }
    }
  ],
  
  compute: (inputs, abilities) => {
    const { math, format } = abilities;
    
    // ä½¿ç”¨æ•°å­¦èƒ½åŠ›
    const heightInMeters = math.divide(inputs.èº«é«˜, 100);
    const bmi = math.divide(inputs.ä½“é‡, math.pow(heightInMeters, 2));
    
    // åˆ†ç±»é€»è¾‘
    const category = 
      bmi < 18.5 ? 'åç˜¦' :
      bmi < 24 ? 'æ­£å¸¸' :
      bmi < 28 ? 'åèƒ–' : 'è‚¥èƒ–';
    
    return {
      bmi: format.number(bmi, 2),
      category
    };
  },
  
  display: (result) => (
    <div className="text-center py-8">
      <div className="text-6xl font-bold text-purple-600 mb-4">
        {result.bmi}
      </div>
      <div className="text-2xl text-gray-600">
        {result.category}
      </div>
    </div>
  )
});
```

### 5.2 æ±‡ç‡è½¬æ¢å™¨

**ç”¨æˆ·éœ€æ±‚**ï¼š"åšä¸€ä¸ªæ±‡ç‡è½¬æ¢å™¨"

**LLMç¼–æ’**ï¼š
```typescript
import { Framework } from '@factoria/core';
import { http, math, format } from '@factoria/abilities';

export default Framework.define({
  name: 'æ±‡ç‡è½¬æ¢å™¨',
  description: 'å®æ—¶æ±‡ç‡è½¬æ¢',
  
  inputs: [
    {
      name: 'é‡‘é¢',
      type: 'number',
      label: 'é‡‘é¢',
      required: true
    },
    {
      name: 'æºè´§å¸',
      type: 'select',
      options: ['CNY', 'USD', 'EUR', 'JPY', 'GBP'],
      defaultValue: 'CNY'
    },
    {
      name: 'ç›®æ ‡è´§å¸',
      type: 'select',
      options: ['CNY', 'USD', 'EUR', 'JPY', 'GBP'],
      defaultValue: 'USD'
    }
  ],
  
  compute: async (inputs, abilities) => {
    const { http, math, format } = abilities;
    
    // ä½¿ç”¨HTTPèƒ½åŠ›è·å–æ±‡ç‡
    const rateData = await http.get(
      `https://api.exchangerate.com/latest?base=${inputs.æºè´§å¸}`
    );
    
    const rate = rateData.rates[inputs.ç›®æ ‡è´§å¸];
    
    // ä½¿ç”¨æ•°å­¦èƒ½åŠ›è®¡ç®—
    const result = math.multiply(inputs.é‡‘é¢, rate);
    
    // ä½¿ç”¨æ ¼å¼åŒ–èƒ½åŠ›
    return {
      amount: format.currency(result, inputs.ç›®æ ‡è´§å¸),
      rate: format.number(rate, 4)
    };
  },
  
  display: (result) => (
    <div className="text-center py-8">
      <div className="text-5xl font-bold text-green-600 mb-4">
        {result.amount}
      </div>
      <div className="text-sm text-gray-500">
        æ±‡ç‡: {result.rate}
      </div>
    </div>
  )
});
```

### 5.3 å–æ°´é‡è¿½è¸ªï¼ˆå¸¦å­˜å‚¨ï¼‰

**ç”¨æˆ·éœ€æ±‚**ï¼š"è¿½è¸ªæ¯å¤©å–æ°´é‡"

**LLMç¼–æ’**ï¼š
```typescript
import { Framework } from '@factoria/core';
import { storage, format, math } from '@factoria/abilities';

export default Framework.define({
  name: 'å–æ°´é‡è¿½è¸ª',
  description: 'è®°å½•æ¯å¤©å–æ°´æƒ…å†µ',
  
  inputs: [
    {
      name: 'æ—¥æœŸ',
      type: 'date',
      defaultValue: 'today'
    },
    {
      name: 'æ°´é‡',
      type: 'number',
      label: 'æ°´é‡(ml)',
      required: true,
      validation: { min: 0, max: 10000 }
    }
  ],
  
  compute: (inputs, abilities) => {
    const { storage, format, math } = abilities;
    
    // ä½¿ç”¨å­˜å‚¨èƒ½åŠ›è·å–å†å²è®°å½•
    const records = storage.get('water-records') || [];
    
    // æ·»åŠ æ–°è®°å½•
    const newRecord = {
      date: inputs.æ—¥æœŸ,
      amount: inputs.æ°´é‡,
      timestamp: Date.now()
    };
    
    records.push(newRecord);
    
    // ä½¿ç”¨å­˜å‚¨èƒ½åŠ›ä¿å­˜
    storage.set('water-records', records);
    
    // ä½¿ç”¨æ•°å­¦èƒ½åŠ›è®¡ç®—ç»Ÿè®¡
    const todayRecords = records.filter(r => r.date === inputs.æ—¥æœŸ);
    const total = math.reduce(
      todayRecords.map(r => r.amount),
      (sum, amount) => math.add(sum, amount),
      0
    );
    
    return {
      today: format.number(total, 0),
      records: todayRecords
    };
  },
  
  display: (result) => (
    <div>
      <div className="text-center py-8">
        <div className="text-4xl font-bold text-blue-600 mb-2">
          {result.today} ml
        </div>
        <div className="text-gray-500">ä»Šæ—¥é¥®æ°´é‡</div>
      </div>
      
      <div className="bg-white rounded-lg p-4">
        <h3 className="font-bold mb-2">ä»Šæ—¥è®°å½•</h3>
        {result.records.map((r, i) => (
          <div key={i} className="py-2 border-b">
            {r.amount} ml
          </div>
        ))}
      </div>
    </div>
  )
});
```

---

## 6. éƒ¨ç½²æ¶æ„

```
ç”¨æˆ·è¾“å…¥éœ€æ±‚
    â†“
ã€Web UIã€‘
React App (Vercel)
    â†“
ã€API Layerã€‘
/api/orchestrate (Serverless)
    â†“
ã€LLM Layerã€‘
GLM-5 API
â”œâ”€ ç†è§£éœ€æ±‚
â”œâ”€ è¯†åˆ«èƒ½åŠ›
â””â”€ ç”Ÿæˆç¼–æ’ä»£ç 
    â†“
ã€Runtime Layerã€‘
Vercel Edge Functions
â”œâ”€ æ‰§è¡Œç¼–æ’ä»£ç 
â”œâ”€ è°ƒç”¨èƒ½åŠ›åº“
â””â”€ è¿”å›ç»“æœ
    â†“
ã€Storage Layerã€‘
Supabase
â”œâ”€ å­˜å‚¨åº”ç”¨è®°å½•
â””â”€ ç¼“å­˜èƒ½åŠ›æ•°æ®
    â†“
è¿”å›ç»™ç”¨æˆ·
```

---

## 7. æŠ€æœ¯æ ˆæ€»ç»“

### 7.1 Frameworkå±‚
- React 18 + TypeScript
- Vite 7
- Tailwind CSS 4
- Vercel (éƒ¨ç½²)

### 7.2 Abilitieså±‚
- @factoria/abilities (èƒ½åŠ›åº“)
- @factoria/core (æ¡†æ¶æ ¸å¿ƒ)
- Supabase (å­˜å‚¨)
- å¤–éƒ¨API (æ±‡ç‡ã€å¤©æ°”ç­‰)

### 7.3 Orchestrationå±‚
- GLM-5 API (ç¼–æ’ç”Ÿæˆ)
- Vercel Edge Functions (è¿è¡Œæ—¶)
- TypeScript Compiler (ä»£ç æ‰§è¡Œ)

---

## 8. æœªæ¥æ‰©å±•

### 8.1 èƒ½åŠ›æ‰©å±•
- æ›´å¤šç¡®å®šæ€§èƒ½åŠ›ï¼ˆåŠ å¯†ã€å‹ç¼©ã€è§£æï¼‰
- æ›´å¤šAIèƒ½åŠ›ï¼ˆå›¾åƒã€è¯­éŸ³ã€è§†é¢‘ï¼‰
- æ›´å¤šè®¾å¤‡èƒ½åŠ›ï¼ˆç›¸æœºã€éº¦å…‹é£ã€ä¼ æ„Ÿå™¨ï¼‰
- æ›´å¤šæœåŠ¡ç«¯èƒ½åŠ›ï¼ˆè®¤è¯ã€æ”¯ä»˜ã€é€šçŸ¥ï¼‰

### 8.2 æ¡†æ¶æ‰©å±•
- PWAæ”¯æŒï¼ˆç¦»çº¿ä½¿ç”¨ï¼‰
- Mobileæ”¯æŒï¼ˆReact Nativeï¼‰
- Desktopæ”¯æŒï¼ˆElectronï¼‰

### 8.3 ç¼–æ’æ‰©å±•
- ä»PRDæ–‡æ¡£è‡ªåŠ¨ç”Ÿæˆ
- ä»æ•°æ®æŒ–æ˜è‡ªåŠ¨å‘ç°
- ä»ç”¨æˆ·è¡Œä¸ºå­¦ä¹ ä¼˜åŒ–

---

**æ¶æ„ç‰ˆæœ¬**: 2.0
**æ ¸å¿ƒåˆ›æ–°**: ä»æ¨¡æ¿é©±åŠ¨ â†’ èƒ½åŠ›é©±åŠ¨
**å…¬å¼**: Agent-Native Software = Framework(Abilities Orchestrated by LLM)
